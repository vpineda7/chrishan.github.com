<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet/less" type="text/css" href="http://127.0.0.1:8000/theme/css/style.less">
  <script src="http://127.0.0.1:8000/theme/js/less-1.3.3.min.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/css/style.css"> -->

  <link rel="stylesheet" type="text/css" href="http://127.0.0.1:8000/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width; initial-scale=1.0">
  <meta name="author" content="Han Xiaogang">
  <meta name="description" content="Posts and writings by Han Xiaogang">

  <link href="http://127.0.0.1:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Han Xiaogang's Blog Full Atom Feed" />

<meta name="keywords" content="[]">

  <title>
Parsing Evernote export file (.enex) using Python  </title>

</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://127.0.0.1:8000">
        <img src="https://pbs.twimg.com/profile_images/1202954668/hxg_-_small.JPG" alt="logo">
      </a>
      <h2><a href="http://127.0.0.1:8000">Han Xiaogang</a></h2>
      <p>Information Retrieval & Data Mining; Web and Python developer; Growing toy ideas into next big things.</p>
      <ul>
        <li><a href="http://127.0.0.1:8000/pages/project.html">Project</a></li>
        <li><a href="http://127.0.0.1:8000/pages/research.html">Research</a></li>
        <li><a href="mailto:xganghanATgmailDOTcom" target="_blank">Email</a></li>
        <li><a href="http://twitter.com/xiaoganghan" target="_blank">Twitter</a></li>
        <li><a href="https://github.com/chrishan" target="_blank">GitHub</a></li>
        <li><a href="http://sg.linkedin.com/in/xghan/" target="_blank">LinkedIn</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
<p>Posted on Sat 22 September 2012</p>
    </header>

<article>
  <div id="article_title">
    <h3><a href="http://127.0.0.1:8000/parsing-evernote-export-file-enex-using-python.html">Parsing Evernote export file (.enex) using Python</a></h3>
  </div>
  <div id="article_text">
    <h3>Introduction</h3>
<p>My wife keeps all the stories written about our baby in Evernote and
then publishes them on her blog every few days. Recently, as the baby
boy is going to celebrate his first birthday, my wife plans to publish
the stories as a book. This post is about how I exported the notes into
xml, parsed &amp; cleaned up the xml file into plain text before converting
it to TeX format.</p>
<h3>Step1 - Export notes</h3>
<p><img alt="image" src="http://hanxiaogang.com/site_media/static/images/posts/evernote1.png" />
<img alt="image" src="http://hanxiaogang.com/site_media/static/images/posts/evernote2.png" /></p>
<h3>Step2 - Parsing</h3>
<p>The scripts used to parse the enex file exported from Evernote:</p>
<p>{% highlight python %}
from lxml import etree
from StringIO import StringIO</p>
<p>p = etree.XMLParser(remove_blank_text=True, resolve_entities=False)
def parseNoteXML(xmlFile):
    context = etree.iterparse(xmlFile, encoding='utf-8', strip_cdata=False)
    note_dict = {}
    notes = []
    for ind, (action, elem) in enumerate(context):
        text = elem.text
        if elem.tag == 'content':
            text = []
            r = etree.parse(StringIO(elem.text.encode('utf-8')), p)
            for e in r.iter():
                try:
                    text.append(e.text)
                except:
                    print 'cannot print'
        note_dict[elem.tag] = text
        if elem.tag == "note":
            notes.append(note_dict)
            note_dict = {}
    return notes</p>
<p _="%" endhighlight="endhighlight">if <strong>name</strong> == '<strong>main</strong>':
    notes = parseNoteXML('mynote.enex')</p>
<p>A typical enex file:</p>
<p _="%" endhighlight="endhighlight">{% highlight xml %}
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export2.dtd"&gt;
  <en-export export-date="20120727T073610Z" application="Evernote" version="Evernote Mac 3.0.5 (209942)">
    <note>
      <title>Vim Tips</title>
      <content>
      &lt;![CDATA[&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
        &lt;!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"&gt;
          <en-note style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
    yank for copy, delete for cut, put for parse
    <div>
            <br/>
          </div>
          <div>Move in context, not position</div>
          <div>/ search forward</div>
          <div>? search backward</div>
          <div>n repeat last search</div>
          <div>N repeat last search but in the opposite direction</div>
          <div>tx move to 'x'</div>
          <div>fx find 'x'</div>
        </en-note>
    ]]&gt;
      </content>
      <created>20101229T161500Z</created>
      <updated>20101231T161039Z</updated>
      <note-attributes/>
    </note>
  </en-export></p>
<p>The parsing result for the enex file:</p>
<p _="%" endhighlight="endhighlight">{% highlight python %}
[{'content': ['\nyank for copy, delete for cut, put for parse\n',
              None,
              None,
              'Move in context, not position',
              '/ search forward',
              '? search backward',
              'n repeat last search',
              'N repeat last search but in the opposite direction',
              "tx move to 'x'",
              "fx find 'x'"],
  'created': '20101229T161500Z',
  'note': None,
  'note-attributes': None,
  'title': 'Vim Tips',
  'updated': '20101231T161039Z'}]</p>
<h3>Summary</h3>
<p>The source is avaiable as a <a href="https://gist.github.com/3186646">gist</a>.
Hope it helpful if you face the similar situations.</p>
  </div>
  <div id="article_meta">
    <p>Category: <a href="http://127.0.0.1:8000/category/.html"></a></p>
    <p>Tags:
      <a href="http://127.0.0.1:8000/tag/.html">[]</a>    </p>
    <p>Comments: <a href="#" onclick="javascript:toggleComments();return false;">toggle</a></p>
  </div>

    <div id="article_comments" style="display:block">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
           var disqus_identifier = "parsing-evernote-export-file-enex-using-python.html";
           (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://chrishan.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
    </div>

</article>

    <footer>
<p><a href="http://127.0.0.1:8000/" class="button_accent">&larr; Back to Index</a></p>
<script language="javascript">
    function toggleComments() {
        var commentDiv = document.getElementById("article_comments");
        (commentDiv.style.display == "none") ? commentDiv.style.display = "block" : commentDiv.style.display = "none";
        return false;
    }
</script>
    </footer>

    <div id="ending_message">
      <p>&copy Han Xiaogang. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>. .</p>
    </div>
  </main>
</body>
</html>