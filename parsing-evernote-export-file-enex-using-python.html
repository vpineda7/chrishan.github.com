<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" type="text/css" href="/theme/css/style.css">
	<!--<link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">-->
	<!--<script src="/theme/js/less.js" type="text/javascript"></script>-->
	<link rel="stylesheet" type="text/css" href="/theme/css/pygments.css">
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:800,400,300|Inconsolata' rel='stylesheet' type='text/css'>

	<link href="/" type="application/atom+xml" rel="alternate" title="Han Xiaogang's Blog ATOM Feed" />
	
	
			<title>Han Xiaogang's Blog</title>
		<meta charset="utf-8" />
	</head>
<body>
	<section id="sidebar">
		<figure id="user_logo">
            <a href=""><div class="logo">&nbsp;</div></a>
		</figure>

		<div class="user_meta">
            <h1 id="user"><a href="" class="">Han Xiaogang</a></h1>
			<h2></h2>
						<ul>
																			<li><a href="/pages/about.html">About</a></li>
											<li><a href="/pages/project.html">Project</a></li>
											<li><a href="/pages/research.html">Research</a></li>
																		<li><a href="http://getpelican.com/">Pelican</a></li>
									<li><a href="http://python.org/">Python.org</a></li>
									<li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
									<li><a href="#">You can modify those links in your config file</a></li>
							</ul>
		</div>
		<footer>
			<address>
				Powered by <a href="http://pelican.notmyidea.org/">Pelican</a>,
		                theme by <a href="https://github.com/wting/pelican-svbtle">wting</a>.
			</address>
		</footer>
	</section>

	<section id="posts">
			<header>
		<h1>Han Xiaogang's blog</h1>
		<h3>Posted Sat 22 September 2012</h3>
	</header>
	<article>
		<h1 id="title">
			<a href="/parsing-evernote-export-file-enex-using-python.html" rel="bookmark"
				title="Permalink to Parsing Evernote export file (.enex) using Python">Parsing Evernote export file (.enex) using Python</a>
		</h1>
		<h3>Introduction</h3>
<p>My wife keeps all the stories written about our baby in Evernote and
then publishes them on her blog every few days. Recently, as the baby
boy is going to celebrate his first birthday, my wife plans to publish
the stories as a book. This post is about how I exported the notes into
xml, parsed &amp; cleaned up the xml file into plain text before converting
it to TeX format.</p>
<h3>Step1 - Export notes</h3>
<p><img alt="image" src="http://hanxiaogang.com/site_media/static/images/posts/evernote1.png" />
<img alt="image" src="http://hanxiaogang.com/site_media/static/images/posts/evernote2.png" /></p>
<h3>Step2 - Parsing</h3>
<p>The scripts used to parse the enex file exported from Evernote:</p>
<p>{% highlight python %}
from lxml import etree
from StringIO import StringIO</p>
<p>p = etree.XMLParser(remove_blank_text=True, resolve_entities=False)
def parseNoteXML(xmlFile):
    context = etree.iterparse(xmlFile, encoding='utf-8', strip_cdata=False)
    note_dict = {}
    notes = []
    for ind, (action, elem) in enumerate(context):
        text = elem.text
        if elem.tag == 'content':
            text = []
            r = etree.parse(StringIO(elem.text.encode('utf-8')), p)
            for e in r.iter():
                try:
                    text.append(e.text)
                except:
                    print 'cannot print'
        note_dict[elem.tag] = text
        if elem.tag == "note":
            notes.append(note_dict)
            note_dict = {}
    return notes</p>
<p _="%" endhighlight="endhighlight">if <strong>name</strong> == '<strong>main</strong>':
    notes = parseNoteXML('mynote.enex')</p>
<p>A typical enex file:</p>
<p _="%" endhighlight="endhighlight">{% highlight xml %}
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export2.dtd"&gt;
  <en-export export-date="20120727T073610Z" application="Evernote" version="Evernote Mac 3.0.5 (209942)">
    <note>
      <title>Vim Tips</title>
      <content>
      &lt;![CDATA[&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
        &lt;!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"&gt;
          <en-note style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;">
    yank for copy, delete for cut, put for parse
    <div>
            <br/>
          </div>
          <div>Move in context, not position</div>
          <div>/ search forward</div>
          <div>? search backward</div>
          <div>n repeat last search</div>
          <div>N repeat last search but in the opposite direction</div>
          <div>tx move to 'x'</div>
          <div>fx find 'x'</div>
        </en-note>
    ]]&gt;
      </content>
      <created>20101229T161500Z</created>
      <updated>20101231T161039Z</updated>
      <note-attributes/>
    </note>
  </en-export></p>
<p>The parsing result for the enex file:</p>
<p _="%" endhighlight="endhighlight">{% highlight python %}
[{'content': ['\nyank for copy, delete for cut, put for parse\n',
              None,
              None,
              'Move in context, not position',
              '/ search forward',
              '? search backward',
              'n repeat last search',
              'N repeat last search but in the opposite direction',
              "tx move to 'x'",
              "fx find 'x'"],
  'created': '20101229T161500Z',
  'note': None,
  'note-attributes': None,
  'title': 'Vim Tips',
  'updated': '20101231T161039Z'}]</p>
<h3>Summary</h3>
<p>The source is avaiable as a <a href="https://gist.github.com/3186646">gist</a>.
Hope it helpful if you face the similar situations.</p>

		<div id="article_meta">
							Category:
					<a href="/category/.html"></a>
										<br />Tags:
									<a href="/tag/.html">[]</a>
									</div>
	</article>

	<footer>
		<a href="/" class="button_accent">&larr;&nbsp;&nbsp;&nbsp;Back to blog</a>
	</footer>

		<div id="comments">
		<h2>Comments</h2>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
			var disqus_identifier = "parsing-evernote-export-file-enex-using-python.html";
			(function() {
				var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				dsq.src = 'http://chrishan.disqus.com/embed.js';
				(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			})();
		</script>
		<noscript>Please enable JavaScript to view <a href="http://disqus.com/?ref_noscript">comments</a>.</noscript>
	</div>
	
	</section>

	</body>
</html>